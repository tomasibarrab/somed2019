module.exports = (fsPromise, Utils, Promise, Bundle) ->

  class BundlesReader

    constructor: (@bundlesPath) ->

    readBundles: (files) =>
      bundleMap = {}
      for fileName in files
        bundleName = fileName.split(".").slice(0,-1).join(".")
        bundleMap[bundleName] = Utils.readJsonFile("#{@bundlesPath}/#{fileName}")
          .then (contents) =>
            Bundle.create(contents, bundleName)
      Promise.props(bundleMap)

    getBundles: =>
      fsPromise
        .readdirAsync(@bundlesPath)
        .then(@readBundles)
        .catch (err) ->
          console.warn "cannot find bundles", err
