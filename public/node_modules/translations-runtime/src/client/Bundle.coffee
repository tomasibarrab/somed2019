module.exports = (_, Logger) ->

  class Bundle

    @DefaultKeySmartlingConfig: {
      translate_mode: "all"
      placeholder_format_custom: ["\\{+\\w+\\}+"]
      source_key_paths: ["/{*}/"]
    }

    constructor: (data, @bundleName) ->
      _.extend(@, data)
      @smartling.fileUri ?= @smartling.resourceId
      @smartling.fileType ?= "json"
      @smartling.contentType ?= "application/json"
      @keys.smartling = _.clone(Bundle.DefaultKeySmartlingConfig) unless @keys.smartling is Object(@keys.smartling)
      @validate()

    @create: (data, bundleName) ->
      new Bundle(data, bundleName)

    validate: ->
      if not @smartling.fileUri
        @errorNoFileUri()
      if not @smartling.userIdentifier or not @smartling.userSecret
        @errorMissingCredentials()

    errorNoFileUri: ->
      Logger.error("Unable to find a 'fileUri' or 'resourceId' for #{@bundleName}.")

    errorMissingCredentials: ->
      Logger.error("#{@bundleName} needs Smartling user credentials.")
