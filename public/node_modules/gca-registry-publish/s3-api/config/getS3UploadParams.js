const _ = require('lodash');
const { fatal } = require('../../utils/utils');

const appFolderName = process.cwd();
const appPackageJson = require(`${appFolderName}/package.json`);
const { getPackageVersion } = require('gca-mono/lib/load-local-package');

// AWS_ACCESS_KEY_ID & AWS_SECRET_ACCESS_KEY are required directly by the underlying `aws-sdk`.
const S3_BUCKET = process.env.S3_BUCKET || 'gcweb-cdn';
const PREFIX_BASE = 'gc-microapps-v2';

const getS3Config = function () {
  const buildNumber = getPackageVersion();

  return {
    buildNumber,
    s3: {
      bucket: S3_BUCKET,
      prefix: PREFIX_BASE,
    },
    package: appPackageJson,
  };
};

module.exports = getS3Config;
