import {
  act,
  cleanup,
  fireEvent,
  render,
  wait,
  waitForDomChange,
} from '@testing-library/react';
import React from 'react';
import GoogleRecaptcha from './GoogleRecaptcha';

jest.mock('../common/api');

afterEach(cleanup);

describe('GoogleRecaptcha component', () => {
  test('Component rendered the host element and the script for V3', () => {
    const { container, debug } = render(
      <GoogleRecaptcha
        apiUrl="http://localhost"
        sitekeyV2="sitekey2"
        sitekeyV3="sitekey3"
        action="login"
      />);
    const elms: HTMLCollectionOf<Element> = container.getElementsByClassName('g-recaptcha');
    expect(elms.length === 1).toBeTruthy();
    const host = elms[0];
    expect(host.getAttribute('data-sitekey')).toEqual('sitekey2');

    const script = host.parentNode.nextSibling;
    expect(script.nodeName === 'SCRIPT').toBeTruthy();
  });
});
