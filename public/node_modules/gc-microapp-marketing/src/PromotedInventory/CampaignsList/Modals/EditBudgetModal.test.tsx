import React from 'react';
import { IntlProvider } from 'react-intl';
import { Provider } from 'react-redux';
import { create } from 'react-test-renderer';
import configureMockStore from 'redux-mock-store';

import { CampaignType, ModalType } from '../../../store/campaigns/campaigns.types';
import { State } from '../../../store/types';
import { keys } from '../../../translations/bundles/marketing.json';
import EditBudgetModal from './EditBudgetModal';

const createComponent = (campaignId, confirm, close, monthlyBudget, credits) => {
  const state: State = {
    campaigns: {
      modal: {
        campaign: {
          maxBid: 3,
          monthlyBudget: 100,
          pricingTier: {
            currencyCode: 'USD',
            price: 3,
            tier: 'High',
          },
        } as CampaignType,
        currentBudget: {
          cap: 99,
          covers: 10,
          credits: 6,
          price: 3,
          spend: 30,
        },
        type: ModalType.EditBudget,
      },
    },
  };
  const store = configureMockStore()(state);
  return create(
    <Provider store={store}>
      <IntlProvider locale="en-US" messages={keys}>
        <EditBudgetModal
          campaignId={campaignId}
          confirm={confirm}
          close={close}
          monthlyBudget={monthlyBudget}
          credits={credits}
        />
      </IntlProvider>
    </Provider>,
  );
};

describe('<EditBudgetModal />', () => {
  const mockCampaignId = 'mock-campaignid';
  const mockMonthlyBudget = 500;
  const mockCredits = 200;

  it('should match snapshot', () => {
    const close = jest.fn();
    const confirm = jest.fn();

    const component = createComponent(mockCampaignId, confirm, close, mockMonthlyBudget, mockCredits);

    const tree = component.toJSON();
    expect(tree).toMatchSnapshot();
  });
});
