import React from 'react';

import { Field } from 'redux-form';
import ProfileHoursAdaptor from './ProfileHoursAdaptor';

/* eslint-disable react/prop-types */

export class ProfileHoursField extends React.Component {
  getShiftErrors = shift => {
    const errors = {};
    const { invalidName, invalidDays, invalidTimeRange } = this.props.labels;

    if (!this.validateShiftName(shift)) {
      errors.name = invalidName;
    }

    if (!this.validateShiftDays(shift)) {
      errors.days = invalidDays;
    }

    if (!this.validateShiftTimes(shift)) {
      errors.timeRange = invalidTimeRange;
    }

    return errors;
  };

  validateShift = shift =>
    this.validateShiftDays(shift) && this.validateShiftName(shift) && this.validateShiftTimes(shift);

  validateShiftDays = ({ days }) => days.length > 0;

  validateShiftTimes = ({ shiftStarts, shiftEnds }) => shiftEnds.length > 0 && shiftStarts.length > 0;

  validateShiftName = ({ standardShiftName, customShiftName }) =>
    (standardShiftName != null && standardShiftName.id.length > 0) ||
    (customShiftName != null && customShiftName.name.length > 0);

  validate = shifts => {
    const allValid = shifts.reduce((valid, shift) => valid && this.validateShift(shift), true);
    return allValid ? false : shifts.map(this.getShiftErrors);
  };

  render() {
    return <Field {...this.props} component={ProfileHoursAdaptor} validate={this.validate} />;
  }
}

export default ProfileHoursField;
