import { types as mixpanelTypes } from './mixpanel';
import './rxjsOperators';

const MIXPANEL_PROP = 'GCA_FIRST_VISIT';
export const types = {
  SHOW_INTRO_VIDEO: 'gca/mixpanel/SHOW_INTRO_VIDEO',
};

export const actions = {
  showIntroVideo: () => ({ type: types.SHOW_INTRO_VIDEO }),
};

export const introVideoEpic = (action$) =>
  action$.ofType(mixpanelTypes.MIXPANEL_LOADED)
    .filter(() => window.mixpanel.get_property(MIXPANEL_PROP) !== 'false')
    .do(() => window.mixpanel.register({ [MIXPANEL_PROP]: 'false' }))
    .mapTo(actions.showIntroVideo());
