import isObject from './isObject';

export default function merge(a, b) {
  const result = {};
  const keys = [...new Set([...Object.keys(a), ...Object.keys(b)])];

  keys.forEach(key => {
    const aVal = a[key];
    const bVal = b[key];
    let newValue;

    if (bVal === undefined) {
      newValue = aVal;
    } else if (a === undefined) {
      newValue = bVal;
    } else if (isObject(aVal) && isObject(bVal)) {
      newValue = merge(aVal, bVal);
    } else {
      newValue = bVal;
    }

    if (Array.isArray(newValue)) {
      // Quickest available method to clone an array.
      newValue = [].concat(newValue);
    }

    result[key] = newValue;
  });

  return result;
}
