import React from 'react';
import { RecentRestaurants } from './RecentRestaurants';
import { ScopeSelectorInner, ScopeSelectorInterface } from './ScopeSelectorInner';
import { FeatureToggle } from '@buffet/feature-toggle-context';
import { enforceGlobalSingleton } from '@buffet/utils';

const SEARCH_GROUPS_TOGGLE = 'globalScopeSelectorIncludeGroups';

const context = enforceGlobalSingleton('ScopeSelectorContext', () =>
  React.createContext<ScopeSelectorInterface>(undefined as any)
);

const Provider = context.Provider;
const Consumer = context.Consumer;

export { Consumer as ScopeSelectorConsumer, Provider as ScopeSelectorInnerProvider };

export class ScopeSelectorProvider extends React.Component {
  public render() {
    return (
      <RecentRestaurants>
        {({ addRestaurant, restaurants }) => (
          <FeatureToggle feature={SEARCH_GROUPS_TOGGLE}>
            {featureTogglesState => (
              <ScopeSelectorInner
                addRecentRestaurant={addRestaurant}
                recentRestaurants={restaurants}
                children={this.props.children}
                featureToggleState={featureTogglesState}
              />
            )}
          </FeatureToggle>
        )}
      </RecentRestaurants>
    );
  }
}
