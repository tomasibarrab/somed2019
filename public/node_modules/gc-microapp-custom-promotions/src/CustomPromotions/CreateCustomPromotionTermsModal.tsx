import { ExternalLinkIcon } from 'gca-react-components';
import React, { SFC } from 'react';
import { FormattedMessage, InjectedIntlProps, injectIntl } from 'react-intl';
import { CreateCustomPromotionPayload, CreditsModel } from '../store/customPromotions/customPromotions.types';
import { LINK_TO_CUSTOM_PROMOTIONS_TERMS_V1 } from './constants';
import Modal from './Modal/Modal';
import ModalHeader from './Modal/ModalHeader';
import ModalMain from './Modal/ModalMain';
import RestaurantName from './RestaurantName/RestaurantName';
import TermsAndConditions, { TermsFVWithBrowserInfo } from './TermsAndConditions/TermsAndConditions';

interface OP {
  formValuesSnapshot: any;
  close: () => void;
  confirm: (payload: CreateCustomPromotionPayload) => void;
  credits: CreditsModel;
}

type Props = OP & InjectedIntlProps;
export const CreateCustomPromotionTermsModal: SFC<Props> = ({ formValuesSnapshot, close, confirm, intl, credits }) => {
  const addLinkToTermsAndConfirm = (termsFVWithBrowserInfo: TermsFVWithBrowserInfo): void => {
    const approvalInfo = { ...termsFVWithBrowserInfo, linkToTerms: LINK_TO_CUSTOM_PROMOTIONS_TERMS_V1 };
    confirm({ approvalInfo, formValues: formValuesSnapshot });
  };

  const { formattedCoverPrice } = credits;
  return (
    <Modal onClose={close} modalClass="creation-terms-modal">
      <ModalHeader onClose={close} title={intl.formatMessage({ id: 'guestcampaigns.terms.terms_and_conditions' })} />
      <ModalMain className="creation-terms-modal-main">
        <RestaurantName />
        <div className="intro">
          <FormattedMessage
            id="guestcampaigns.custom_promotions.terms.description.1"
            values={{
              formattedCoverPrice,
              'terms-and-conditions-link': (
                <>
                  <a href={LINK_TO_CUSTOM_PROMOTIONS_TERMS_V1} target="_blank">
                    {intl.formatMessage({ id: 'guestcampaigns.terms.opentable_client_agreement' })}
                    <ExternalLinkIcon width="10px" height="10px" color="#4A90E2" />
                  </a>
                </>
              ),
            }}
          />
        </div>
        <TermsAndConditions
          credits={credits}
          formValuesSnapshot={formValuesSnapshot}
          detailsOpen={false}
          confirm={addLinkToTermsAndConfirm}
        />
      </ModalMain>
    </Modal>
  );
};
export default injectIntl(CreateCustomPromotionTermsModal);
