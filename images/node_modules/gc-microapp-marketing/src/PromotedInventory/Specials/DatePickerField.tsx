import { Chevron } from 'gca-react-components';
import moment from 'moment';
import { Moment } from 'moment';
import React, { SFC } from 'react';
import 'react-dates/initialize';
import DayPicker from 'react-dates/lib/components/DayPickerSingleDateController.js';
import { FormattedMessage } from 'react-intl';
import { Field } from 'redux-form';
import { dateFormat } from '../constants';

interface Props {
  name: string;
  disableBefore?: Moment;
}

const DatePickerField: SFC<Props> = props => {
  const { name, disableBefore } = props;
  return (
    <Field
      name={name}
      component={renderDatePicker}
      parse={value => value.format(dateFormat.MOMENT)}
      format={value => (value ? moment(value) : undefined)}
      props={{ disableBefore } as any}
    />
  );
};

const renderDatePicker = (props: any) => {
  const { input, meta: { submitFailed, error }, disableBefore } = props;
  return (
    <div className="specials-date-picker">
      <DayPicker
        date={input.value}
        daySize={47}
        hideKeyboardShortcutsPanel
        isDayBlocked={(day: any) => (disableBefore ? moment(disableBefore) : moment()).isAfter(day)}
        navNext={<Chevron height="20" direction="right" color="#A8AFC3" />}
        navPrev={<Chevron height="20" direction="left" color="#A8AFC3" />}
        onDateChange={input.onChange}
      />
      {submitFailed && error && <FormattedMessage id="guestcampaigns.specials.form.enddate.invalid" />}
    </div>
  );
};

export default DatePickerField;
