import get from 'lodash.get';
import React, { SFC } from 'react';
import { formValues } from 'redux-form';
import { dayOrdering, days, times, timesOrdering } from './constants';

interface FormValuesProps {
  [index: string]: any;
}

export const DaysAndTimesSummary: SFC<FormValuesProps> = props => {
  /* Make sure we place them in order */
  const daysDescription = dayOrdering
    .map((day: any) => {
      const timesDescription =
        props[day] &&
        timesOrdering /* Grab the Time's short name if its entry is true. */
          .map((time: any) => get(props, [day, time], false) && get(times, [time, 'short']))
          .filter(name => name); /* get rid of the ones that were false or nonexistent */
      return (
        timesDescription &&
        timesDescription.length > 0 &&
        `${get(days, [day, 'short'])} (${timesDescription.join(', ')})`
      );
    })
    .filter(dayDescription => dayDescription); /* Get rid of empty day descriptions */

  return <span>{daysDescription.join(', ')}</span>;
};

/* Each day becomes a prop */
export default formValues<any, any>(...dayOrdering)(DaysAndTimesSummary);
