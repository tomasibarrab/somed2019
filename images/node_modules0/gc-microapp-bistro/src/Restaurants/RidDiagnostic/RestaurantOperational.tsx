import * as React from 'react';

import { Button } from '@buffet/button';
import { Input } from '@buffet/input';

import { useAsync } from 'shared-react-utils/useAsync';

import * as api from '../../api';
import DataDisplay from '../../common/DataDisplay/DataDisplay';
import DataKeyValueDisplay from '../../common/DataDisplay/DataKeyValueDisplay';
import strings from '../../strings';
import { RidData, RidInputState } from '../../types';
import { initialRidInputState, validateRidInput } from '../../utils';

import './MiniDashboard.scss';

export default function RestaurantOperational() {
  const [ state, setState ] = React.useState<RidInputState>(initialRidInputState);
  const [ apiStatus, makeRestaurantOperational ] = useAsync(api.makeRestaurantOperational);
  const [ ridData, setRidData ] = React.useState<RidData>();

  const handleSubmit = () => {
    setState({ ...state, id: state.input });
    makeRestaurantOperational(state.input)
      .then(setRidData)
  };

  const handleKeyPress: React.KeyboardEventHandler<HTMLInputElement> = e => {
    if (e.charCode === 13) {
      setState({ ...state, id: state.input });
    }
  };

  const handleChange = ({ target: { value } }: any) => {
    setState({ ...state, input: value, touched: true });
  };

  const valid = validateRidInput(state);
  return (
    <div className="mini-dashboard">
      <div className="select-rid">
        <span className="label">{strings['button.operational.warning']}</span>
        <Input
          valid={valid}
          id={`id-input`}
          className="id-input"
          placeholder={`Enter rid`}
          type="text"
          onChange={handleChange}
          onKeyPress={handleKeyPress}
          value={state.input}
        />
        <Button theme="primary" type="button" onClick={handleSubmit} disabled={!valid}>
          {strings['button.operational']}
        </Button>
      </div>
      <DataDisplay status={apiStatus}>
        <div className="data-table">
          <DataKeyValueDisplay {...ridData} />
        </div>
      </DataDisplay>
    </div>
  );
}
