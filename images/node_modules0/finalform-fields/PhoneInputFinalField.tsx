import * as React from 'react';
import { FieldRenderProps } from 'react-final-form';

import PhoneInput, { PhoneInputProps } from '@buffet/phone-input';

import { customFinalField, InputFieldProps } from './customfield';

import './FinalField.scss';

type PhoneInputFieldProps = InputFieldProps<Partial<PhoneInputProps>>;

const phoneInputRenderer = () => (
  { id, label, errorText, className = '', valid,  ...restProps }: PhoneInputFieldProps,
  { input }: FieldRenderProps,
) => {
  return (
    <div id={id} className={`${className} final-field ${valid ? '' : 'final-field-invalid'}`}>
      <PhoneInput
        {...input}
        {...restProps}
        label={label || ''}
        error={errorText}
        value={input.value.value}
        defaultCountry={input.value.defaultCountry}
      />
    </div>
  );
};

/**
 * PhoneInputField react-final-form field for buffet PhoneInput component
 */
export const PhoneInputFinalField = customFinalField<Partial<PhoneInputProps>>(phoneInputRenderer());
