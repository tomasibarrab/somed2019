{"version":3,"file":"react-final-form-arrays.umd.js","sources":["../src/diffSubscription.js","../src/renderComponent.js","../src/FieldArray.js"],"sourcesContent":["// @flow\nexport default function<Subscription: { [string]: boolean }>(\n  a: ?Subscription,\n  b: ?Subscription,\n  keys: string[]\n): boolean {\n  if (a) {\n    if (b) {\n      // $FlowFixMe\n      return keys.some(key => a[key] !== b[key])\n    } else {\n      return true\n    }\n  } else {\n    return !!b\n  }\n}\n","// @flow\nimport * as React from 'react'\nimport type { RenderableProps } from './types'\n\n// shared logic between components that use either render prop,\n// children render function, or component prop\nexport default function renderComponent<T>(\n  props: RenderableProps<T> & T,\n  name: string\n): React.Node {\n  const { render, children, component, ...rest } = props\n  if (component) {\n    return React.createElement(component, { ...rest, children }) // inject children back in\n  }\n  if (render) {\n    return render({ ...rest, children }) // inject children back in\n  }\n  // istanbul ignore next\n  if (typeof children !== 'function') {\n    if (process.env.NODE_ENV !== 'production') {\n      console.error(\n        `Warning: Must specify either a render prop, a render function as children, or a component prop to ${name}`\n      )\n      return null // warning will alert developer to their mistake\n    }\n  }\n  return children(rest)\n}\n","// @flow\nimport * as React from 'react'\nimport { polyfill } from 'react-lifecycles-compat'\nimport {\n  fieldSubscriptionItems,\n  version as ffVersion,\n  ARRAY_ERROR\n} from 'final-form'\nimport { version as rffVersion } from 'react-final-form'\nimport diffSubscription from './diffSubscription'\nimport type { FieldSubscription, FieldState, FieldValidator } from 'final-form'\nimport type { Mutators } from 'final-form-arrays'\nimport type { FieldArrayPropsWithForm as Props, FieldArrayProps } from './types'\nimport renderComponent from './renderComponent'\nimport type { ReactContext } from 'react-final-form'\nimport { withReactFinalForm } from 'react-final-form'\nexport const version = '2.0.1'\n\nconst versions = {\n  'final-form': ffVersion,\n  'react-final-form': rffVersion,\n  'react-final-form-arrays': version\n}\n\nconst all: FieldSubscription = fieldSubscriptionItems.reduce((result, key) => {\n  result[key] = true\n  return result\n}, {})\n\ntype State = {\n  state: ?FieldState\n}\n\nclass FieldArray extends React.Component<Props, State> {\n  props: Props\n  state: State\n  mutators: Mutators\n  mounted: boolean\n  unsubscribe: () => void\n\n  static displayName = `ReactFinalFormFieldArray(${ffVersion})(${version})`\n\n  constructor(props: Props) {\n    super(props)\n    let initialState\n    // istanbul ignore next\n    if (process.env.NODE_ENV !== 'production' && !props.reactFinalForm) {\n      console.error(\n        'Warning: FieldArray must be used inside of a ReactFinalForm component'\n      )\n    }\n    const { reactFinalForm } = props\n    if (reactFinalForm) {\n      // avoid error, warning will alert developer to their mistake\n      this.subscribe(props, (state: FieldState) => {\n        if (initialState) {\n          this.notify(state)\n        } else {\n          initialState = state\n        }\n      })\n    }\n    this.state = { state: initialState }\n    this.bindMutators(props)\n    this.mounted = false\n  }\n\n  isEqual = (a: Array<any>, b: Array<any>) => {\n    if (typeof this.props.isEqual === 'function') {\n      return this.props.isEqual(a, b)\n    }\n\n    return true\n  }\n\n  subscribe = (\n    { name, subscription }: Props,\n    listener: (state: FieldState) => void\n  ) => {\n    this.unsubscribe = this.props.reactFinalForm.registerField(\n      name,\n      listener,\n      subscription ? { ...subscription, length: true } : all,\n      {\n        getValidator: () => this.validate,\n        isEqual: this.isEqual\n      }\n    )\n  }\n\n  validate: FieldValidator = (...args) => {\n    const { validate } = this.props\n    if (!validate) return undefined\n    const error = validate(args[0], args[1])\n    if (!error || Array.isArray(error)) {\n      return error\n    } else {\n      const arrayError = []\n      // gross, but we have to set a string key on the array\n      ;((arrayError: any): Object)[ARRAY_ERROR] = error\n      return arrayError\n    }\n  }\n\n  bindMutators = ({ name }: Props) => {\n    const { reactFinalForm } = this.props\n    if (reactFinalForm) {\n      const { mutators } = reactFinalForm\n      const hasMutators = !!(mutators && mutators.push && mutators.pop)\n      // istanbul ignore next\n      if (process.env.NODE_ENV !== 'production' && !hasMutators) {\n        console.error(\n          'Warning: Array mutators not found. You need to provide the mutators from final-form-arrays to your form'\n        )\n      }\n      if (hasMutators) {\n        this.mutators = Object.keys(mutators).reduce((result, key) => {\n          result[key] = (...args) => mutators[key](name, ...args)\n          return result\n        }, {})\n      }\n    }\n  }\n\n  notify = (state: FieldState) => {\n    setTimeout(() => {\n      if (this.mounted) {\n        this.setState({ state })\n      }\n    })\n  }\n\n  forEach = (iterator: (name: string, index: number) => void): void => {\n    const { name } = this.props\n    // required || for Flow, but results in uncovered line in Jest/Istanbul\n    // istanbul ignore next\n    const length = this.state.state ? this.state.state.length || 0 : 0\n    for (let i = 0; i < length; i++) {\n      iterator(`${name}[${i}]`, i)\n    }\n  }\n\n  map = (iterator: (name: string, index: number) => any): any[] => {\n    const { name } = this.props\n    // required || for Flow, but results in uncovered line in Jest/Istanbul\n    // istanbul ignore next\n    const length = this.state.state ? this.state.state.length || 0 : 0\n    const results: any[] = []\n    for (let i = 0; i < length; i++) {\n      results.push(iterator(`${name}[${i}]`, i))\n    }\n    return results\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\n    const { name, subscription } = nextProps\n    if (\n      this.props.name !== name ||\n      diffSubscription(\n        this.props.subscription,\n        subscription,\n        fieldSubscriptionItems\n      )\n    ) {\n      if (this.props.reactFinalForm) {\n        // avoid error, warning will alert developer to their mistake\n        this.unsubscribe()\n        this.subscribe(nextProps, this.notify)\n      }\n    }\n    if (this.props.name !== name) {\n      this.bindMutators(nextProps)\n    }\n  }\n\n  componentDidMount() {\n    this.mounted = true\n  }\n\n  componentWillUnmount() {\n    this.mounted = false\n    this.unsubscribe()\n  }\n\n  render() {\n    const { name, ...rest } = this.props\n    let {\n      length,\n      active,\n      dirty,\n      dirtySinceLastSubmit,\n      error,\n      initial,\n      invalid,\n      pristine,\n      submitError,\n      submitFailed,\n      submitSucceeded,\n      touched,\n      valid,\n      visited,\n      ...fieldStateFunctions\n    } = this.state.state || {}\n    const meta = {\n      active,\n      dirty,\n      dirtySinceLastSubmit,\n      error,\n      initial,\n      invalid,\n      pristine,\n      submitError,\n      submitFailed,\n      submitSucceeded,\n      touched,\n      valid,\n      visited\n    }\n    const fieldState = {\n      ...meta,\n      ...fieldStateFunctions\n    }\n    return renderComponent(\n      {\n        fields: {\n          name,\n          forEach: this.forEach,\n          length,\n          map: this.map,\n          ...this.mutators,\n          ...fieldState\n        },\n        meta,\n        ...rest,\n        __versions: versions\n      },\n      `FieldArray(${name})`\n    )\n  }\n}\n\npolyfill(FieldArray)\n\nconst decorated: React.ComponentType<\n  FieldArrayProps & ReactContext\n> = withReactFinalForm(FieldArray)\n\nexport default decorated\n"],"names":["a","b","keys","some","key","renderComponent","props","name","render","children","component","rest","React","console","error","version","versions","ffVersion","rffVersion","all","fieldSubscriptionItems","reduce","result","FieldArray","isEqual","listener","subscription","unsubscribe","reactFinalForm","registerField","length","getValidator","validate","undefined","Array","isArray","arrayError","ARRAY_ERROR","mutators","hasMutators","push","pop","process","Object","args","state","setTimeout","mounted","setState","iterator","i","results","initialState","subscribe","notify","bindMutators","UNSAFE_componentWillReceiveProps","nextProps","diffSubscription","componentDidMount","componentWillUnmount","active","dirty","dirtySinceLastSubmit","initial","invalid","pristine","submitError","submitFailed","submitSucceeded","touched","valid","visited","fieldStateFunctions","meta","fieldState","fields","forEach","map","__versions","polyfill","decorated","withReactFinalForm"],"mappings":"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"}