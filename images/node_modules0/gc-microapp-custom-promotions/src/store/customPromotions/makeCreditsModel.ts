import {
  currencySymbolMap,
  DEFAULT_CURRENCY_SYMBOL_DOLLARS,
  DEFAULT_NUM_COVERS,
} from '../../CustomPromotions/constants';
import { CreditsModel, CreditsResponse } from './customPromotions.types';

const makeCreditsModel = (data: CreditsResponse): CreditsModel => {
  const { creditAmount, activeCustomPromotion } = data;
  const shouldShowCredits = !activeCustomPromotion && creditAmount > 0;

  const { coverPrice } = data;
  /* Initialize the number of covers for the slider. */
  const defaultCovers = shouldShowCredits ? Math.round(creditAmount / (coverPrice - 1)) : DEFAULT_NUM_COVERS;
  const defaultBudget = defaultCovers * coverPrice;
  const currencySymbol = currencySymbolMap[data.currencyCode] || DEFAULT_CURRENCY_SYMBOL_DOLLARS;

  return Object.assign({}, data, {
    currencySymbol,
    defaultBudget,
    defaultCovers,
    formattedCoverPrice: `${currencySymbol}${coverPrice.toFixed(2)}`,
    shouldShowCredits,
  });
};

export default makeCreditsModel;
