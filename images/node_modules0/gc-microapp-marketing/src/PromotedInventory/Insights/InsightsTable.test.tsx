import { mount } from 'enzyme';
import React from 'react';
import { IntlProvider } from 'react-intl';
import { Provider } from 'react-redux';
import { MemoryRouter } from 'react-router';
import configureMockStore from 'redux-mock-store';

import { keys } from '../../translations/bundles/marketing.json';
import InsightsTable from './InsightsTable';
import mockCampaigns from './mockCampaigns.json';

jest.mock('./common/DateRange/DateRange', () => () => 'DateRange');
jest.mock('../../store/insights/selectors', () => ({
  filters: jest.fn(),
  getCampaignDetails: () => mockCampaigns,
  getInsights: jest.fn(),
}));

jest.mock('../../common/App/App', () => ({
  Routes: {
    CustomPromotions: '/custom-promotions',
    FlexiblePricing: '/flexible-pricing',
    GuestCampaigns: '/guest-campaigns',
    Specials: '/specials',
  },
}));

describe('<InsightsTable />', () => {
  it('should match screenshot', () => {
    const store = configureMockStore([])({
      insights: {
        coverTrends: {
          error: false,
          loading: false,
        },
        summaryCurrent: {
          data: undefined,
          loading: false,
        },
        summaryPrevious: {
          data: undefined,
          loading: false,
        },
      },
    });

    const wrapper = mount(
      <Provider store={store}>
        <IntlProvider locale="en" messages={keys}>
          <MemoryRouter>
            <InsightsTable />
          </MemoryRouter>
        </IntlProvider>
      </Provider>,
    );

    expect(wrapper.debug()).toMatchSnapshot();
  });
});
