
import '@buffet/base-styles';
import { IntlProvider as BuffetIntlProvider, registerMessages } from '@buffet/intl';
import React from 'react';
import ReactDOM from 'react-dom';
import { BrowserRouter } from 'react-router-dom';

import App from './common/App/App';
import GoogleRecaptcha from './recaptcha/GoogleRecaptcha';
import { translationMessages } from './translations/i18n';

import './app.scss';

registerMessages(translationMessages);

const render = () => {

  // temporary support both basenames till the experiment is done
  const basename = window.location.pathname.startsWith('/login-v2')
    ? '/login-v2'
    : '/login';

  // recaptcha sitekeys are passed thru the window.hydronator from the registry
  // the default one for the local dev (might be configured ?)
  const hydronator: any = window.hydronator;
  const sitekeyV2 = hydronator.recaptchaKeyV2 || '6LfLkoIUAAAAAGhB-UlIUpcBjTqTFVdae_WOmdAG';
  const sitekeyV3 = hydronator.recaptchaKeyV3 || '6Lcn1X4UAAAAAPA83CPD7LgSGwuhM_IBno9qjlSJ';

  ReactDOM.render((
    <>
      <BuffetIntlProvider>
        <BrowserRouter basename={basename}>
          <App />
        </BrowserRouter>
      </BuffetIntlProvider>
      <GoogleRecaptcha
        apiUrl="https://www.recaptcha.net/recaptcha/api.js"
        sitekeyV2={sitekeyV2}
        sitekeyV3={sitekeyV3}
        action="login"
      />
    </>
  ),
    document.getElementById('app'),
  );
};

render();
