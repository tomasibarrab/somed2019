import React, { useCallback, useState } from 'react';
import { Route, RouteComponentProps, Switch, withRouter } from 'react-router';
import { useHistoryTracking } from 'shared-react-utils/useHistoryTracking';

import ChangePassword from '../../ChangePassword/ChangePassword';
import { eventTracker } from '../../common/tracking';
import Login from '../../Login/Login';
import ForgotPassword from '../../ResetPassword/ForgotPassword';
import ResetPassword from '../../ResetPassword/ResetPassword';
import { Routes } from '../App/routes'
import ConnectionLostModal from '../modal/ConnectionLostModal';

export const ConnectionLostCtx = React.createContext(() => { return; });

const App = ({ history }: RouteComponentProps) => {

  const [isConnectionLost, setIsConnectionLost] = useState(false);

  const showConnectionLost = useCallback(() => {
    setIsConnectionLost(true);
  }, []);

  // Google Analytics: track page views for history changes
  useHistoryTracking(history, eventTracker);

  return (
    <>
      <ConnectionLostCtx.Provider value={showConnectionLost}>
        <Switch>
          <Route exact path={Routes.ChangePassword} component={ChangePassword} />
          <Route exact path={Routes.ResetPassword} component={ResetPassword} />
          <Route exact path={Routes.ForgotPassword} component={ForgotPassword} />
          <Route path={Routes.Login} component={Login} />
        </Switch>
      </ConnectionLostCtx.Provider>
      <ConnectionLostModal isShown={isConnectionLost} />
    </>
  )
};

export default withRouter(App);
