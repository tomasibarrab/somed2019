/**
 *
 * API utils
 *
 */

/**
 * @param {object} query An object with query params as keys.
 * @return {string}      Returns a string constructed as a querystring to append on a url.
 *
 * Example:
 *
 * const query = { rid: 123, startDate: '2016-07-21', numberOfReviews: 40 };
 * const queryString = buildAllReviewsQueryString(query);
 * console.log(queryString); // '?rid=123&startDate=2016-07-21&numberOfReviews=40'
 *
 */

interface Query {
  rid: number;
  startDate?: string;
  endDate?: string;
  [key: string]: any;
}

export const buildAllReviewsQueryString = (query: Query): string => {
  if (query.startDate === undefined && query.endDate === undefined) {
    throw new Error('A request to /all-reviews must include either a startDate or endDate');
  }

  const unencodedQueryString = Object.keys(query).reduce(
    (queryString, key) => (!queryString.length ? `?${key}=${query[key]}` : `${queryString}&${key}=${query[key]}`),
    '',
  );

  return encodeURI(unencodedQueryString);
};
