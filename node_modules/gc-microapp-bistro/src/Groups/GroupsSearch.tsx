import React from 'react';
import { RouteComponentProps } from 'react-router-dom';

import { Button } from '@buffet/button';
import { Panel } from '@buffet/panel';

import * as api from '../api';
import { useHistorySearch } from '../common/Hooks/usehistorysearch';
import { SearchInfo } from '../common/SearchInfo/SearchInfo';
import { SearchInput } from '../common/SearchInput/SearchInput';
import strings from '../strings';
import { headerButtonStyle } from '../styles';

import { GroupsResult } from './GroupsResult';


const CreateNewGroup = ({onClick}: { onClick: () => void }) => (
  <Button type="button" theme="primary" onClick={onClick} >
    {strings['group.add.new']}
  </Button>
)

type Props = RouteComponentProps<any>;

const defaultSearch = {
  query: '',
}

export function GroupsSearch(props: Props) {
  const [ search, searchSet ] = useHistorySearch(api.searchGroups, defaultSearch, props);

  function handleChange({ target: { value } }: any) {
    searchSet({ query: value });
  };

  function handleCreateGroupClick() {
    window.location.pathname = '/group-settings/guest-share-admin/group-details';
  }

  return (
    <Panel
      title={strings['groups.title']}
      headerContent={<CreateNewGroup onClick={handleCreateGroupClick} />}
      customHeaderStyle={headerButtonStyle}
    >
      <SearchInput
        label={strings['groups.search.label']}
        value={search.value.query}
        onChange={handleChange}
      />
      <SearchInfo status={search.status} result={search.result} />
      {search.result && <GroupsResult restaurants={search.result.items} />}
    </Panel>
  );
}

