export const fileTypeData = 'data:text/csv;charset=utf-8,';

const convertedToCsvEncodedString = (rows: []) => {
  const csv = `${fileTypeData}${convertedToCsv(rows)}`;
  return encodeURI(csv);
};

export const convertedToCsv = (rows: []) => {
  const escapedRows = rows.map((row: []) => csvEscapeRowItems(row));
  const csv = `${escapedRows.map((row: any) => row.join(',')).join('\n')}`;
  return csv;
};

const csvEscapeRowItems = (items: any) => items.map((item: string) => `"${csvEscapeCharacters(item)}"`);

const csvEscapeCharacters = (val: string) => {
  const REGEX_ENUMS = {
    DOUBLE_QUOTE: /"/g,
    NEW_LINES: /\n|\r/g,
  };

  let value = val;

  if (val === undefined) {
    value = '';
  }

  return value
    .toString()
    .replace(REGEX_ENUMS.DOUBLE_QUOTE, '""')
    .replace(REGEX_ENUMS.NEW_LINES, '');
};

export default convertedToCsvEncodedString;
